/*! Crocodoc Viewer - v0.10.8 | (c) 2015 Box */

!function(e){"use strict";e.Crocodoc=function(e){return"object"!=typeof exports?e(jQuery):void (module.exports=e)}(function(t){function n(){e.loadSVG=function(t){var n=new e.DOMParser,r=n.parseFromString(t,"image/svg+xml"),i=document.importNode(r.documentElement,!0);i.setAttribute("width","100%"),i.setAttribute("height","100%"),document.body?document.body.appendChild(i):document.documentElement.appendChild(i)}}var r="crocodoc-",i="data-svg-version",s=r+"viewer",o=r+"doc",u=r+"viewport",f=r+"viewer-logo",l=r+"draggable",c=r+"dragging",h=r+"text-selected",p=r+"text-disabled",d=r+"links-disabled",v=r+"mobile",m=r+"ielt9",g=r+"supports-svg",y=r+"window-as-viewport",b=r+"layout-",w=r+"current-page",E=r+"preceding-page",S=r+"page",x=S+"-inner",T=S+"-content",N=S+"-svg",C=S+"-text",k=S+"-link",L=S+"-links",A=S+"-autoscale",O=S+"-loading",M=S+"-error",_=S+"-visible",A=S+"-autoscale",D=S+"-prev",P=S+"-next",H=S+"-before",B=S+"-after",j=S+"-before-buffer",F=S+"-after-buffer",I=[P,B,D,H,j,F].join(" "),q='<div tabindex="-1" class="'+u+'"><div class="'+o+'"></div></div><div class="'+f+'"></div>',R='<div class="'+S+" "+O+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+x+'"><div class="'+T+'"><div class="'+N+'"></div><div class="'+A+'"><div class="'+C+'"></div><div class="'+L+'"></div></div></div></div></div>',U=1024,z="fitwidth",W="fitheight",X="auto",V="in",$="out",J="previous",K="next",Q="vertical",G="vertical-single-column",Y="horizontal",Z="presentation",et="presentation-two-page",tt="text",nt="converting",rt="not loaded",it="loading",st="loaded",ot="error",ut="padding-",at=ut+"top",ft=ut+"right",lt=ut+"left",ct=ut+"bottom",ht=.95,pt=.99,dt=100,vt=32,mt=8,gt=1e3,yt="image/svg+xml",bt="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",wt='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+n+")()]]></script></svg>",Et=1,St=2,xt=3,Tt=4,Nt=5,Ct=6,kt=7,Lt=8;if("undefined"==typeof t)throw new Error("jQuery is required");var At=function(){function e(n,r,i){var s;for(i=i||n,s=0;s<r.length;++s){if(n===r[s])throw new Error("Circular dependency detected: "+i+"->"+r[s]);t[r[s]]&&e(n,t[r[s]].mixins,i+"->"+r[s])}}var t={},n={};return{ZOOM_FIT_WIDTH:z,ZOOM_FIT_HEIGHT:W,ZOOM_AUTO:X,ZOOM_IN:V,ZOOM_OUT:$,SCROLL_PREVIOUS:J,SCROLL_NEXT:K,LAYOUT_VERTICAL:Q,LAYOUT_VERTICAL_SINGLE_COLUMN:G,LAYOUT_HORIZONTAL:Y,LAYOUT_PRESENTATION:Z,LAYOUT_PRESENTATION_TWO_PAGE:et,LAYOUT_TEXT:tt,ASSET_REQUEST_RETRIES:1,viewerTemplate:q,pageTemplate:R,components:t,utilities:n,createViewer:function(e,t){return new At.Viewer(e,t)},getViewer:function(e){return At.Viewer.get(e)},addComponent:function(n,r,i){r instanceof Function&&(i=r,r=[]),e(n,r),t[n]={mixins:r,creator:i}},createComponent:function(e,n){var r=t[e];if(r){for(var i=[],s=0;s<r.mixins.length;++s)i.push(this.createComponent(r.mixins[s],n));return i.unshift(n),r.creator.apply(r.creator,i)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addDataProvider:function(e,t){this.addComponent("data-provider-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){At.Scope=function(e){function n(e,t){var n,r,i,u;for(n=0,r=o.length;r>n;++n)i=o[n],i&&(u=i.messages||[],-1!==s.inArray(e,u)&&s.isFn(i.onmessage)&&i.onmessage.call(i,e,t))}function r(){for(var e;u.length;)e=u.shift(),n(e.name,e.data);u=null}function i(e){s.isFn(e.destroy)&&!e._destroyed&&(e.destroy(),e._destroyed=!0)}var s=At.getUtility("common"),o=[],u=[],a={},f=!1;e.dataProviders=e.dataProviders||{},this.createComponent=function(e){var t=At.createComponent(e,this);return t&&(t.componentName=e,o.push(t)),t},this.destroyComponent=function(e){var t,n;for(t=0,n=o.length;n>t;++t)if(e===o[t]){i(e),o.splice(t,1);break}},this.destroy=function(){var e,t,n,r=o.slice();for(e=0,t=r.length;t>e;++e)n=r[e],i(n);o=[],a={}},this.broadcast=function(e,t){f?n(e,t):u.push({name:e,data:t})},this.getUtility=function(e){return At.getUtility(e)},this.getConfig=function(){return e},this.ready=function(){f||(f=!0,r())},this.get=function(n,r){var i=e.dataProviders[n]||n,s=this.getDataProvider(i);return s?s.get(n,r):t.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(e){var t;return a[e]?t=a[e]:(t=this.createComponent("data-provider-"+e),a[e]=t),t}}}(),function(){function e(e,t){var n=!1;return{type:e,data:t,preventDefault:function(){n=!0},isDefaultPrevented:function(){return n}}}At.EventTarget=function(){this._handlers={}},At.EventTarget.prototype={constructor:At.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(t,n){var r,i,s,o=e(t,n);if(r=this._handlers[o.type],r instanceof Array)for(r=r.concat(),i=0,s=r.length;s>i;i++)r[i]&&r[i].call(this,o);if(r=this._handlers.all,r instanceof Array)for(r=r.concat(),i=0,s=r.length;s>i;i++)r[i]&&r[i].call(this,o);return o},off:function(e,t){var n,r,i=this._handlers[e];if(i instanceof Array){if(!t)return void (i.length=0);for(n=0,r=i.length;r>n;n++)if(i[n]===t||i[n].handler===t){i.splice(n,1);break}}},one:function(e,t){var n=this,r=function(i){n.off(e,r),t.call(n,i)};r.handler=t,this.on(e,r)}}}(),function(){var e=0,n={};At.Viewer=function(r,i){function s(){h.init()}At.EventTarget.call(this);var o,u=At.getUtility("common"),f=t(r),l=u.extend(!0,{},At.Viewer.defaults,i),c=new At.Scope(l),h=c.createComponent("viewer-base");if(0===f.length)throw new Error("Invalid container element");this.id=l.id=++e,l.api=this,l.$el=f,n[this.id]=this,this.destroy=function(){delete n[l.id],c.broadcast("destroy"),c.destroy()},this.load=function(){h.loadAssets()},this.setLayout=function(e){o=null,o=h.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);o&&(t&&(e=t/(l.pageScale||1)),o.setZoom(e))},this.scrollTo=function(e){o&&u.isFn(o.scrollTo)&&o.scrollTo(e)},this.scrollBy=function(e,t){o&&o.scrollBy(e,t)},this.focus=function(){o&&o.focus()},this.enableTextSelection=function(){f.toggleClass(p,!1),l.enableTextSelection||(l.enableTextSelection=!0,c.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){f.toggleClass(p,!0),l.enableTextSelection&&(l.enableTextSelection=!1,c.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){l.enableLinks||(f.removeClass(d),l.enableLinks=!0)},this.disableLinks=function(){l.enableLinks&&(f.addClass(d),l.enableLinks=!1)},this.updateLayout=function(){o&&o.update()},s()},At.Viewer.prototype=new At.EventTarget,At.Viewer.prototype.constructor=At.Viewer,At.Viewer.get=function(e){return n[e]},At.Viewer.defaults={url:null,layout:Q,zoom:X,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,autoloadFirstPage:!0,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),At.addDataProvider("metadata",function(e){function t(e){return r.parseJSON(e)}var n=e.getUtility("ajax"),r=e.getUtility("common"),i=e.getConfig();return{get:function(){var e=this.getURL(),r=n.fetch(e,At.ASSET_REQUEST_RETRIES);return r.then(t).promise({abort:r.abort})},getURL:function(){var e=i.template.json;return i.url+e+i.queryString}}}),At.addDataProvider("page-img",function(e){var n=e.getUtility("common"),r=e.getConfig();return{get:function(e,n){function r(){s.setAttribute("src",a)}function i(){s&&s.removeAttribute("src")}var s=this.getImage(),o=At.ASSET_REQUEST_RETRIES,u=!1,a=this.getURL(n),f=t.Deferred();return s.onload=function(){u=!0,f.resolve(s)},s.onerror=function(){o>0?(o--,i(),r()):(s=null,u=!1,f.reject({error:"image failed to load",resource:a}))},r(),f.promise({abort:function(){u||(i(),f.reject())}})},getURL:function(e){var t=n.template(r.template.img,{page:e});return r.url+t+r.queryString},getImage:function(){return new Image}}}),At.addDataProvider("page-svg",function(e){function t(e,t){var n="<style>"+t+"</style>";return o.firefox&&!u.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(c,n)}function n(n){if(!f){var s,o=a.queryString.replace("&","&#38;");return s=i.countInStr(n,'xlink:href="data:image'),s>r&&(n=n.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),n=n.replace(/href="([^"#:]*)"/g,function(e,t){return'href="'+a.url+t+o+'"'}),e.get("stylesheet").then(function(e){return t(n,e)})}}var r=1e3,i=e.getUtility("common"),s=e.getUtility("ajax"),o=e.getUtility("browser"),u=e.getUtility("subpx"),a=e.getConfig(),f=!1,l={},c=/<xhtml:link[^>]*>(\s*<\/xhtml:link>)?/i;return{get:function(e,t){var r,i=this.getURL(t);return l[t]?l[t]:(r=s.fetch(i,At.ASSET_REQUEST_RETRIES),l[t]=r.then(n).promise({abort:function(){r.abort(),l&&delete l[t]}}),l[t])},getURL:function(e){var t=i.template(a.template.svg,{page:e});return a.url+t+a.queryString},destroy:function(){f=!0,i=s=u=o=a=l=null}}}),At.addDataProvider("page-text",function(e){function t(e){if(!o){var t=r.countInStr(e,"<div");return t>n?"":e=e.replace(/<link rel="stylesheet".*/,"")}}var n=256,r=e.getUtility("common"),i=e.getUtility("ajax"),s=e.getConfig(),o=!1,u={};return{get:function(e,n){var r,s=this.getURL(n);return u[n]?u[n]:(r=i.fetch(s,At.ASSET_REQUEST_RETRIES),u[n]=r.then(t).promise({abort:function(){r.abort(),u&&delete u[n]}}),u[n])},getURL:function(e){var t=r.template(s.template.html,{page:e});return s.url+t+s.queryString},destroy:function(){o=!0,r=i=s=u=null}}}),At.addDataProvider("stylesheet",function(e){function t(e){return i.ie&&(e=e.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+s.id)),e}var n,r=e.getUtility("ajax"),i=e.getUtility("browser"),s=e.getConfig();return{get:function(){if(n)return n;var e=r.fetch(this.getURL(),At.ASSET_REQUEST_RETRIES);return n=e.then(t).promise({abort:function(){e.abort(),n=null}})},getURL:function(){var e=s.template.css;return s.url+e+s.queryString},destroy:function(){r=i=s=null,n=null}}}),At.addUtility("ajax",function(e){function n(e){var t,n,r;try{t=e.status,n=e.statusText,r=e.responseText}catch(i){t=0,n="",r=null}return{status:t,statusText:n,responseText:r,rawRequest:e}}function r(e){return"file:"===c.parse(e).protocol}function i(e){return e>=200&&300>e||304===e}function s(e){return e=f.extend(!0,{},e||{}),e.method=e.method||"GET",e.headers=e.headers||[],e.data=e.data||"","string"!=typeof e.data&&(e.data=t.param(e.data),"GET"!==e.method&&(e.data=e.data,e.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),e}function o(e,t){var n;for(n=0;n<t.length;++n)e.setRequestHeader(t[n][0],t[n][1])}function u(e,t,n,s,u,a){var f=l.getXHR();return f.open(t,e,!0),f.onreadystatechange=function(){var t;if(4===f.readyState){f.onreadystatechange=function(){};try{t=f.status}catch(n){return void a(f)}0===t&&r(e)&&(t=200),i(t)?u(f):a(f)}},o(f,s),f.send(n),f}function a(e,t,n,r,i){var s=l.getXDR();try{s.open(t,e),s.onload=function(){r(s)},s.onerror=function(){i(s)},s.ontimeout=function(){i(s)},s.onprogress=function(){},s.send(n)}catch(o){return i({status:0,statusText:o.message})}return s}var f=e.getUtility("common"),l=e.getUtility("support"),c=e.getUtility("url");return{request:function(e,t){function r(e){return f.isFn(o.success)&&o.success.call(n(e)),e}function i(e){return f.isFn(o.fail)&&o.fail.call(n(e)),e}var o=s(t),h=o.method,p=o.data,d=o.headers;return"GET"===h&&p&&(e=c.appendQueryParams(e,p),p=""),l.isXHRSupported()?c.isCrossDomain(e)&&!l.isCORSSupported()?a(e,h,p,r,i):u(e,h,p,d,r,i):o.fail({status:0,statusText:"AJAX not supported"})},fetch:function(e,n){function r(e){n>0?(n--,s=i()):a.reject(e)}function i(){return u.request(e,{success:function(){var t,n;if(!o){if(n=this.rawRequest,202===this.status&&f.isFn(n.getResponseHeader)&&(t=parseInt(n.getResponseHeader("retry-after")),t>0))return void setTimeout(i,1e3*t);this.responseText?a.resolve(this.responseText):r({error:"empty response",status:this.status,resource:e})}},fail:function(){o||r({error:this.statusText,status:this.status,resource:e})}})}var s,o=!1,u=this,a=t.Deferred();return s=i(),a.promise({abort:function(){o=!0,s.abort()}})}}}),At.addUtility("browser",function(){var e,t=navigator.userAgent,n={},r=/ip(hone|od|ad)/i.test(t),i=/android/i.test(t),s=/blackberry/i.test(t),o=/webos/i.test(t),u=/silk|kindle/i.test(t),a=/MSIE|Trident/i.test(t);return a&&(n.ie=!0,e=/MSIE/i.test(t)?/MSIE\s+(\d+\.\d+)/i.exec(t):/Trident.*rv[ :](\d+\.\d+)/.exec(t),n.version=e&&parseFloat(e[1]),n.ielt9=n.version<9,n.ielt10=n.version<10,n.ielt11=n.version<11),r&&(n.ios=!0,e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n.version=e&&parseFloat(e[1]+"."+e[2])),n.mobile=/mobile/i.test(t)||r||i||s||o||u,n.firefox=/firefox/i.test(t),/safari/i.test(t)&&(n.chrome=/chrome/i.test(t),n.safari=!n.chrome),n.safari&&(e=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),n.version=e&&parseFloat(e[1])),n}),At.addUtility("common",function(){var n=1.33333,r={};return r.extend=t.extend,r.each=t.each,r.map=t.map,r.param=t.param,r.parseJSON=t.parseJSON,r.stringifyJSON="undefined"!=typeof e.JSON?e.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},t.extend(r,{bisectLeft:function(e,t,n){for(var r,i,s=0,o=e.length;o>s;)i=Math.floor((s+o)/2),r=n?e[i][n]:e[i],t>r?s=i+1:o=i;return s},bisectRight:function(e,t,n){for(var r,i,s=0,o=e.length;o>s;)i=Math.floor((s+o)/2),r=n?e[i][n]:e[i],r>t?o=i:s=i+1;return s},clamp:function(e,t,n){return t>e?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(e,n){return r.isFn(n.indexOf)?n.indexOf(e):t.inArray(e,n)},constrainRange:function(e,t,n){var i=t-e;return 0>i?{min:-1,max:-1}:(e=r.clamp(e,0,n),t=r.clamp(e+i,0,n),i>t-e&&(e=r.clamp(t-i,0,n)),{min:e,max:t})},now:function(){return(new Date).getTime()},throttle:function(e,t){function n(){a=r.now(),o=null,u=t.apply(i,s)}var i,s,o,u,a=0;return function(){var f=r.now(),l=e-(f-a);return i=this,s=arguments,0>=l?(clearTimeout(o),o=null,a=f,u=t.apply(i,s)):o||(o=setTimeout(n,l)),u}},debounce:function(e,t){function n(){var f=r.now()-u;e>f?o=setTimeout(n,e-f):(o=null,a=t.apply(i,s),i=s=null)}var i,s,o,u,a;return function(){return i=this,s=arguments,u=r.now(),o||(o=setTimeout(n,e)),a}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(r){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var r;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(r=e.addRule(t,n,e.rules.length),0>r&&(r=e.rules.length-1),r)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var t,n,r;return e.getSelection?(n=e.getSelection(),n.rangeCount&&(r=n.getRangeAt(0),r.collapsed||(t=n.anchorNode.parentNode))):document.selection&&(t=document.selection.createRange().parentElement()),t},getComputedStyle:function(t){return"getComputedStyle"in e?e.getComputedStyle(t):t.currentStyle},calculatePtSize:function(){var e,t,i=1e4,s=document.createElement("div");return s.style.display="block",s.style.position="absolute",s.style.width=i+"pt",document.body.appendChild(s),e=r.getComputedStyle(s),t=e&&e.width?parseFloat(e.width)/i:n,document.body.removeChild(s),t},countInStr:function(e,t){for(var n,r=0;n=e.indexOf(t,n)+1;)r++;return r},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e}})}),At.addUtility("subpx",function(n){function r(){if(!t.support.leadingWhitespace)return!1;var n=t(o.template(s,{size:12.5})).appendTo(document.documentElement).get(0),r=t(n).css("font-size"),i=t(n).width();t(n).remove(),n=t(o.template(s,{size:12.6})).appendTo(document.documentElement).get(0);var u=t(n).css("font-size"),f=t(n).width();if(t(n).remove(),!("ontouchstart"in e)){if(r===u)return!1;if(i===f)return!1}return!0}var i="crocodoc-subpx-fix",s='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+(new Array(100)).join("A")+"</span>",o=n.getUtility("common"),u=r();return{fix:function(e){if(!u&&void 0!==document.body.style.zoom){var n=t("<div>").addClass(i);t(e).wrap(n)}return e},isSubpxSupported:function(){return u}}}),At.addUtility("support",function(){function t(e){var t,i,s,o=document.createElement("div");if(e in o.style)return e;if(t=e.charAt(0).toUpperCase()+e.substr(1),e in o.style)return e;for(i=0;i<r.length;++i)if(s=r[i]+t,s in o.style)return 0===s.indexOf("ms")&&(s="-"+s),n(s);return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var r=["Moz","Webkit","O","ms"],i=null,s=null;return{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),isXHRSupported:function(){return null===i&&(i=!!this.getXHR()),i},isCORSSupported:function(){return null===s&&(s=this.isXHRSupported()&&"withCredentials"in this.getXHR()),s},isXDRSupported:function(){return"undefined"!=typeof e.XDomainRequest},getXHR:function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}},getXDR:function(){return this.isXDRSupported()?new e.XDomainRequest:null}}}),At.addUtility("url",function(t){var n,r=t.getUtility("browser");return{getCurrentURL:function(){return e.location.href},makeAbsolute:function(e){return this.parse(e).href},isCrossDomain:function(e){var t=this.parse(e);return n||(n=this.parse(this.getCurrentURL())),t.hostname?t.protocol!==n.protocol||t.hostname!==n.hostname||t.port!==n.port:!1},appendQueryParams:function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},parse:function(e){var t,n=document.createElement("a");return n.href=e,r.ie&&e!==n.href&&(e=n.href,n.href=e),t=n.pathname,/^\//.test(t)||(t="/"+t),{href:n.href,protocol:n.protocol,host:n.host,hostname:n.hostname,port:n.port,pathname:t,hash:n.hash,search:n.search}}}}),At.addComponent("controller-paged",function(e){function n(){var e=f.metadata;f.numPages=e.numpages,f.pageStart?f.pageStart<0&&(f.pageStart=e.numpages+f.pageStart):f.pageStart=1,f.pageStart=p.clamp(f.pageStart,1,e.numpages),f.pageEnd?f.pageEnd<0&&(f.pageEnd=e.numpages+f.pageEnd):f.pageEnd=e.numpages,f.pageEnd=p.clamp(f.pageEnd,f.pageStart,e.numpages),f.numPages=f.pageEnd-f.pageStart+1}function r(){var e,n,r,i,s,o,u,a,l=p.calculatePtSize(),c=f.metadata.dimensions,h="";for(f.pageScale=U/(c.width*l),r=f.zoomLevels[f.zoomLevels.length-1],i=3/f.pageScale;i>r;)r+=r/2,f.zoomLevels.push(r);for(c.exceptions=c.exceptions||{},e=f.pageStart-1;e<f.pageEnd;e++)n=e+1,n in c.exceptions?(s=c.exceptions[n].width,o=c.exceptions[n].height):(s=c.width,o=c.height),u=s*l,a=o*l,u*=f.pageScale,a*=f.pageScale,h+=p.template(At.pageTemplate,{w:u,h:a});f.$pages=t(h).appendTo(f.$doc)}function i(e){return f.conversionIsComplete||0===e&&f.autoloadFirstPage?rt:nt}function s(){var t,n,r=[],s=f.pageStart-1,u=f.pageEnd,a=o();for(t=s;u>t;t++)n=e.createComponent("page"),n.init(f.$pages.eq(t-s),{index:t,status:i(t),enableLinks:f.enableLinks,links:a[t],pageScale:f.pageScale}),r.push(n);f.pages=r}function o(){var e,t,n,r,i=f.pageStart,s=f.pageEnd,o=f.metadata.links||[],u=[];for(e=0,t=f.metadata.numpages;t>e;++e)u[e]=[];for(e=0,t=o.length;t>e;++e)if(n=o[e],!(n.pagenum<i||n.pagenum>s)){if(n.destination){if(r=n.destination.pagenum,i>r||r>s)continue;n.destination.pagenum=r-(i-1)}u[n.pagenum-1].push(n)}return u}function u(){a()}function a(){var e=p.getSelectedNode(),n=t(e).closest("."+S);l.find("."+h).removeClass(h),e&&l.has(e)&&n.addClass(h)}var f,l,c,p=e.getUtility("common");return{init:function(){f=e.getConfig(),l=f.$el,t(document).on("mouseup",u),n(),r(),s(),c=e.createComponent("lazy-loader"),c.init(f.pages)},destroy:function(){t(document).off("mouseup",u)}}}),At.addComponent("controller-text",function(e){var n;return{init:function(){var r=e.getConfig();r.$textContainer=t(),n=e.get("page-text",1).then(function(e){var n=r.$doc.parent();r.$doc=t(e),n.html(r.$doc)})},destroy:function(){n.abort()}}}),At.addComponent("dragger",function(n){function r(e){o.scrollTop(u.top-(e.clientY-f.y)),o.scrollLeft(u.left-(e.clientX-f.x)),e.preventDefault()}function i(e){n.broadcast("dragend"),l.off("mousemove",r),l.off("mouseup",i),e.preventDefault()}function s(e){n.broadcast("dragstart"),u={top:o.scrollTop(),left:o.scrollLeft()},f={x:e.clientX,y:e.clientY},l.on("mousemove",r),l.on("mouseup",i),e.preventDefault()}var o,u,f,l=t(e);return{init:function(e){o=t(e),o.on("mousedown",s)},destroy:function(){o.off("mousedown",s),o.off("mousemove",r),l.off("mouseup",i)}}}),At.addComponent("layout-base",function(t){var n=t.getUtility("common");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var e=t.getConfig();this.config=e,this.$el=e.$el,this.$doc=e.$doc,this.$viewport=e.$viewport,this.$pages=e.$pages,this.numPages=e.numPages,this.layoutClass=b+e.layout,this.$el.addClass(this.layoutClass),this.initState()},initState:function(){var t=this.$viewport[0],n=t;t===e&&(n=document.documentElement),this.state={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,viewportDimensions:{clientWidth:n.clientWidth,clientHeight:n.clientHeight,offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},initialWidth:0,initialHeight:0,totalWidth:0,totalHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$el.removeClass(this.layoutClass)},setZoom:function(){},calculateNextZoomLevel:function(e){var t,n=!1,r=this.state.zoomState.zoom,i=this.zoomLevels;if(e===At.ZOOM_IN){for(t=0;t<i.length;++t)if(i[t]>r){n=i[t];break}}else if(e===At.ZOOM_OUT)for(t=i.length-1;t>=0;--t)if(i[t]<r){n=i[t];break}return n},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleResize:function(){},handleScrollEnd:function(){},update:function(){},focus:function(){this.$viewport.focus()},extend:function(e){return n.extend({},this,e)}}}),At.addComponent("layout-"+Y,["layout-paged"],function(e,t){var n=e.getUtility("common"),r=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(z),n=this.calculateZoomValue(W);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(t,n):r.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,r=this.state,i=r.pages;return e=n.bisectRight(i,r.scrollLeft,"x0")-1,t=n.bisectRight(i,r.scrollLeft+i[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,r=e.sumWidths,i=Math.floor(e.tallestPage.totalActualHeight*n),s=Math.max(r,e.viewportDimensions.clientWidth),o=Math.max(i,e.viewportDimensions.clientHeight);this.$doc.css({height:o,lineHeight:o+"px",width:s})}})}),At.addComponent("layout-paged",["layout-base"],function(e,t){function n(e,t){var n,r,o,u,a=e.state,f="."+e.config.namespace+" ."+A,l=e.config.stylesheet,c=a.pages,h=t*e.config.pageScale,p=100/h;for(u=s.csstransform?s.csstransform+":scale("+h+");width:"+p+"%;height:"+p+"%;":s.csszoom?"zoom:"+h:"",a.previousStyleIndex&&i.deleteCSSRule(l,a.previousStyleIndex),a.previousStyleIndex=i.appendCSSRule(l,f,u),n=0,r=c.length;r>n;++n)o=c[n],e.$pages.eq(n).css({width:o.actualWidth*t,height:o.actualHeight*t,paddingTop:o.paddingTop*t,paddingRight:o.paddingRight*t,paddingBottom:o.paddingBottom*t,paddingLeft:o.paddingLeft*t})}function r(e,t){if(!t||0===t.length)return 1/0;var n=i.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var i=e.getUtility("common"),s=e.getUtility("support");return t.extend({init:function(){t.init.call(this),this.updatePageStates(),this.updateZoomLevels()},initState:function(){t.initState.call(this),i.extend(this.state,{pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],currentPage:null,visiblePages:[],fullyVisiblePages:[]})},destroy:function(){t.destroy.call(this),this.$pages.css("padding","")},update:function(){this.updatePageStates(!0),this.setZoom()},setZoom:function(t){var n,r,s=this.state,o=this.parseZoomValue(t),u=s.zoomState,f=u.zoom;n=this.calculateZoomMode(t,o),o=i.clamp(o,s.minZoom,s.maxZoom),e.broadcast("beforezoom",i.extend({page:s.currentPage,visiblePages:i.extend([],s.visiblePages),fullyVisiblePages:i.extend([],s.fullyVisiblePages)},u)),u.prevZoom=f,u.zoom=o,u.zoomMode=n,this.applyZoom(o),u.canZoomIn=this.calculateNextZoomLevel(At.ZOOM_IN)!==!1,u.canZoomOut=this.calculateNextZoomLevel(At.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),r=t===At.ZOOM_AUTO||t===At.ZOOM_FIT_WIDTH||t===At.ZOOM_FIT_HEIGHT,this.updateScrollPosition(r),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",i.extend({page:s.currentPage,visiblePages:i.extend([],s.visiblePages),fullyVisiblePages:i.extend([],s.fullyVisiblePages),isDraggable:this.isDraggable()},u))},parseZoomValue:function(e){var t=parseFloat(e),n=this.state,r=n.zoomState,i=r.zoom,s=i;if(t)s=t;else switch(e){case At.ZOOM_FIT_WIDTH:case At.ZOOM_FIT_HEIGHT:case At.ZOOM_AUTO:s=this.calculateZoomValue(e);break;case At.ZOOM_IN:case At.ZOOM_OUT:s=this.calculateNextZoomLevel(e)||i;break;default:s=i?r.zoomMode?this.calculateZoomValue(r.zoomMode):i:this.calculateZoomValue(this.config.zoom||At.ZOOM_AUTO)}return s},calculateZoomMode:function(e,t){switch(t){case this.calculateZoomValue(At.ZOOM_AUTO):return"string"!=typeof e||e!==At.ZOOM_FIT_WIDTH&&e!==At.ZOOM_FIT_HEIGHT?At.ZOOM_AUTO:e;case this.calculateZoomValue(At.ZOOM_FIT_WIDTH):return At.ZOOM_FIT_WIDTH;case this.calculateZoomValue(At.ZOOM_FIT_HEIGHT):return At.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function e(e){var t=n/e;return e===n?!1:ht>t?!0:i.inArray(e,a)>-1&&pt>t?!0:!1}var t,n,r=this.config.zoomLevels.slice()||[1],s=this.calculateZoomValue(At.ZOOM_AUTO),o=this.calculateZoomValue(At.ZOOM_FIT_WIDTH),u=this.calculateZoomValue(At.ZOOM_FIT_HEIGHT),a=[o,u];for(this.state.minZoom=this.config.minZoom||r[0],this.state.maxZoom=this.config.maxZoom||r[r.length-1],s!==o&&s!==u&&a.push(s),r=r.concat(a),r.sort(function(e,t){return e-t}),this.zoomLevels=[],n=0,t=0;t<r.length;++t)e(r[t])&&(n=r[t],this.zoomLevels.push(n))},calculateZoomValue:function(e){var t=this.state,n=parseFloat(e);return n?n:e===At.ZOOM_FIT_WIDTH?t.viewportDimensions.clientWidth/t.widestPage.totalActualWidth:e===At.ZOOM_FIT_HEIGHT?t.viewportDimensions.clientHeight/t.tallestPage.totalActualHeight:e===At.ZOOM_AUTO?this.calculateZoomAutoValue():t.zoomState.zoom},applyZoom:function(e){n(this,e)},scrollTo:function(e){var t=this.state,n=parseInt(e,10);if("string"==typeof e){if(e===At.SCROLL_PREVIOUS&&t.currentPage>1)n=this.calculatePreviousPage();else if(e===At.SCROLL_NEXT&&t.currentPage<this.numPages)n=this.calculateNextPage();else if(!n)return}else if(!n&&0!==n)return;n=i.clamp(n,1,this.numPages),this.scrollToPage(n)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=i.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,r=e.viewportDimensions.clientWidth;if(0===r||0===n)return{min:-1,max:-1};var s=e.scrollTop,o=s+n,u=e.scrollLeft,a=u+r,f=i.bisectLeft(t,s,"y1"),l=i.bisectRight(t,o,"y0")-1,c=i.bisectLeft(t,u,"x1"),h=i.bisectRight(t,a,"x0")-1,p=Math.max(c,f),d=Math.min(h,l);return i.constrainRange(p,d,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,r=e.viewportDimensions.clientWidth;if(0===r||0===n)return{min:-1,max:-1};var s=e.scrollTop,o=s+n,u=e.scrollLeft,a=u+r,f=i.bisectLeft(t,s,"y0"),l=i.bisectRight(t,o,"y1")-1,c=i.bisectLeft(t,u,"x0"),h=i.bisectRight(t,a,"x1")-1,p=Math.max(c,f),d=Math.min(h,l);return i.constrainRange(p,d,this.numPages-1)},setCurrentPage:function(t){var n=this.state;n.currentPage!==t?(n.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:i.extend([],n.visiblePages),fullyVisiblePages:i.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,r,i=this.state,s=this.calculateVisibleRange(),o=this.calculateFullyVisibleRange();for(i.visiblePages.length=0,i.fullyVisiblePages.length=0,t=0,n=this.$pages.length;n>t;++t)r=this.$pages.eq(t),t<s.min||t>s.max?e&&r.hasClass(_)&&r.removeClass(_):(e&&!r.hasClass(_)&&r.addClass(_),i.visiblePages.push(t+1)),t>=o.min&&t<=o.max&&i.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t,n,i,s,o,u=this.state,a=u.pages,f=u.rows,l=this.$viewport.scrollTop(),c=this.$viewport.scrollLeft(),h=0,p=0,d=0,v=0;for(f.length=u.sumWidths=u.sumHeights=u.totalWidth=u.totalHeight=0,u.widestPage.totalActualWidth=u.tallestPage.totalActualHeight=0,t=0,n=this.$pages.length;n>t;++t)o=this.$pages.eq(t),s=o[0],i=a[t],(!i||e)&&(o.css("padding",""),i={index:t,paddingLeft:parseFloat(o.css(lt)),paddingRight:parseFloat(o.css(ft)),paddingTop:parseFloat(o.css(at)),paddingBottom:parseFloat(o.css(ct))}),i.actualWidth||(i.actualWidth=parseFloat(s.getAttribute("data-width"))),i.actualHeight||(i.actualHeight=parseFloat(s.getAttribute("data-height"))),i.totalActualWidth=i.actualWidth+i.paddingLeft+i.paddingRight,i.totalActualHeight=i.actualHeight+i.paddingTop+i.paddingBottom,i.width=s.offsetWidth,i.height=s.offsetHeight,i.x0=s.offsetLeft,i.y0=s.offsetTop,i.x1=i.width+i.x0,i.y1=i.height+i.y0,p&&r(a,f[h])<=i.y0+2&&h++,p=i.y1,f[h]||(f[h]=[]),i.totalActualWidth>u.widestPage.totalActualWidth&&(u.widestPage=i),i.totalActualHeight>u.tallestPage.totalActualHeight&&(u.tallestPage=i),u.sumWidths+=i.width,u.sumHeights+=i.height,i.rowIndex=h,a[t]=i,f[h].push(t),a[d].x0+a[d].width<i.x0+i.width&&(d=t),a[v].y0+a[v].height<i.y0+i.height&&(v=t);u.totalWidth=a[d].x0+a[d].width,u.totalHeight=a[v].y0+a[v].height,u.scrollTop=l,u.scrollLeft=c,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.updateZoomLevels(),this.setZoom(t)},handleScrollEnd:function(e){this.$doc.find("."+w).removeClass(w),this.$pages.eq(this.state.currentPage-1).addClass(w),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t,n,r=this.state,i=r.zoomState,s=i.zoom/i.prevZoom;t=r.scrollLeft*s,n=r.scrollTop*s,e!==!0&&(n+=r.viewportDimensions.offsetHeight*(s-1)/2,t+=r.viewportDimensions.offsetWidth*(s-1)/2),this.scrollToOffset(t,n)},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}})}),At.addComponent("layout-"+et,["layout-"+Z],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){this.twoPageMode=!0,t.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var n=t.calculateZoomValue.call(this,e);return e===z&&(n/=2),n},scrollToPage:function(e){t.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return n.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),At.addComponent("layout-"+Z,["layout-paged"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){t.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(I)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(z),t=this.calculateZoomValue(W);return Math.min(e,t)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return n.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var r,i,s=n.clamp(e-1,0,this.numPages);t.setCurrentPage.call(this,e),this.$doc.find("."+E).removeClass(E),r=this.$doc.find("."+w),i=this.$pages.eq(s),r[0]!==i[0]&&(r.addClass(E).removeClass(w),i.addClass(w)),this.updateVisiblePages(!0),this.updatePageClasses(s)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e,t,n,r,i,s,o,u=this.state,a=u.zoomState,f=a.zoom,l=this.currentPage||1,c=u.pages[l-1],h=this.twoPageMode?u.pages[l]:c,p=u.viewportDimensions.clientWidth,d=u.viewportDimensions.clientHeight;e=h.actualWidth,t=c.actualWidth+(this.twoPageMode?e:0),n=c.actualHeight,r=Math.floor((t+c.paddingLeft+h.paddingRight)*f),i=Math.floor(c.totalActualHeight*f),s=Math.max(r,p),o=Math.max(i,d),this.$doc.css({width:s,height:o}),this.updatePageMargins(),s>p||o>d?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,r,i,s,o,u,a,f=this.state,l=f.viewportDimensions.clientWidth,c=f.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)r=this.$pages.eq(e),n=f.pages[e],a=this.twoPageMode?e%2===1?n.paddingRight:n.paddingLeft:n.paddingRight+n.paddingLeft,i=(n.actualWidth+a)*f.zoomState.zoom,s=(n.actualHeight+n.paddingTop+n.paddingBottom)*f.zoomState.zoom,this.twoPageMode?(o=Math.max(0,(l-2*i)/2),e%2===1&&(o+=i)):o=(l-i)/2,u=(c-s)/2,o=Math.max(o,0),u=Math.max(u,0),r.css({marginLeft:o,marginTop:u})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,r=t-1,i=20;e.removeClass(I),this.twoPageMode?(n=t+2,r=t-2,e.slice(Math.max(r,0),t).addClass(D),e.slice(n,n+2).addClass(P)):(r>=0&&e.eq(r).addClass(D),n<this.numPages&&e.eq(n).addClass(P)),e.slice(0,t).addClass(H),e.slice(Math.max(0,t-i),t).addClass(j),e.slice(n).addClass(B),e.slice(n,Math.min(this.numPages,n+i)).addClass(F)}})}),At.addComponent("layout-"+tt,["layout-base"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.zoomLevels=this.config.zoomLevels.slice(),this.minZoom=this.zoomLevels[0],this.maxZoom=this.zoomLevels[this.zoomLevels.length-1]},setZoom:function(t){var r,i=this.state.zoomState,s=i.zoom;"string"==typeof t?(r=this.calculateNextZoomLevel(t),r||(r="auto"===t||"fitwidth"===t||"fitheight"===t?1:s)):r=parseFloat(t)||s,r=n.clamp(r,this.minZoom,this.maxZoom),this.config.$doc.css("font-size",10*r+"pt"),i.prevZoom=s,i.zoom=r,i.canZoomIn=this.calculateNextZoomLevel(At.ZOOM_IN)!==!1,i.canZoomOut=this.calculateNextZoomLevel(At.ZOOM_OUT)!==!1,e.broadcast("zoom",n.extend({isDraggable:this.isDraggable()},i))}})}),At.addComponent("layout-"+G,["layout-"+Q],function(e,t){return t}),At.addComponent("layout-"+Q,["layout-paged"],function(e,t){var n=e.getUtility("common"),r=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(z),n=this.calculateZoomValue(W);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,t,n):r.mobile?t:Math.min(1,t)},calculateCurrentPage:function(){var e,t,r,i,s,o=this.state,u=o.pages;return e=n.bisectRight(u,o.scrollTop,"y0")-1,0>e?1:(s=o.scrollTop+u[e].height/2,t=n.bisectRight(u,s,"y0")-1,r=u[t].rowIndex,i=o.rows[r],1+i[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,r=e.rows[n+1];return r&&r[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,r=e.rows[n-1];return r&&r[0]+1||e.currentPage},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e,t,n=this.state,r=n.zoomState.zoom;e=Math.floor(n.widestPage.totalActualWidth*r),t=e<=n.viewportDimensions.clientWidth?"auto":e,this.$doc.css({width:t})}})}),At.addComponent("lazy-loader",function(e){function n(e){e=e||S;var t=C.page-1,n=t-e,r=t+e;return y.constrainRange(n,r,d-1)}function r(){var e;clearTimeout(g),E.length>0?(e=E.shift(),p[e]?w.loadPage(e,function(e){e===!1?r():g=setTimeout(r,dt)}):r()):s()}function i(){clearTimeout(g),x=!1,g=setTimeout(r,dt)}function s(){clearTimeout(g),x=!0}function o(e){E.push(e),x&&i()}function u(){E.length=0,s()}function a(e,t){var r=n(t);return e>=r.min&&e<=r.max?!0:!1}function f(e){var t=p[e];if(t){if(a(e))return!0;if(c(e))return!0}return!1}function l(e,t){return a(e,t)?!1:c(e)?!1:!0}function c(e){return y.inArray(e+1,C.visiblePages)>-1}function h(e,t){for(var n=y.sign(t-e);e!==t;)w.queuePageToLoad(e),e+=n;w.queuePageToLoad(e)}var p,d,v,m,g,y=e.getUtility("common"),b=e.getUtility("browser"),w={},E=[],S=1,x=!0,T=1,N=!1,C={page:1,visiblePages:[1]};return y.extend(w,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(t)}},init:function(e){p=e,d=p.length,S=b.mobile||b.ielt10?mt:vt,S=Math.min(S,d)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){T=y.sign(e.page-C.page),C=e},loadNecessaryPages:y.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(C.page-1),this.loadVisiblePages(),this.loadPagesInRange(S)}),loadPagesInRange:function(e){var t=C.page-1;e>0&&(e=n(e),T>=0?(h(t+1,e.max),h(t-1,e.min)):(h(t-1,e.min),h(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=C.visiblePages.length;t>e;++e)this.queuePageToLoad(C.visiblePages[e]-1)},queuePageToLoad:function(e){f(e)&&(p[e].preload(),o(e))},cancelAllLoading:function(){clearTimeout(m),clearTimeout(v),u()},loadPage:function(e,n){t.when(p[e]&&p[e].load()).always(n)},unloadPage:function(e){var t=p[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=p.length;n>t;++t)l(t,e)&&this.unloadPage(t)},handleReady:function(){N=!0,this.loadVisiblePages(),m=setTimeout(function(){w.loadNecessaryPages()},gt)},handlePageAvailable:function(e){if(N){var t;if(e.all===!0&&(e.upto=d),e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)}},handlePageFocus:function(e){this.updateLayoutState(e),N&&(this.cancelAllLoading(),v=setTimeout(function(){w.loadNecessaryPages()},200))},handleBeforeZoom:function(e){N&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length))},handleZoom:function(e){this.updateLayoutState(e),N&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){N&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(S))}})}),At.addComponent("page-img",function(e){var n,r,i,s,o=e.getUtility("browser"),u=!1,a=o.mobile;return{init:function(e,n){r=t(e),s=n},destroy:function(){a=!0,this.unload(),r.empty()},prepare:function(){},preload:function(){i||(i=e.get("page-img",s))},load:function(){return this.preload(),i.done(function(e){u||(u=!0,n=t(e).appendTo(r))}),i.fail(function(t){u=!1,t&&e.broadcast("asseterror",t)}),i},unload:function(){i&&(i.abort(),i=null),a&&(n&&(n.remove(),n=null),u=!1)}}}),At.addComponent("page-links",function(e){function n(e){var n=t("<a>").addClass(k),o=e.bbox[0],u=e.bbox[1],a={};if(s.ie&&t("<span>").appendTo(n).on("click",r),n.css({left:o+"pt",top:u+"pt",width:e.bbox[2]-o+"pt",height:e.bbox[3]-u+"pt"}),e.uri){if(!/^http|^mailto/.test(e.uri))return;a.href=encodeURI(e.uri),a.target="_blank"}else e.destination&&(a.href="#page-"+e.destination.pagenum);n.attr(a),n.data("link",e),n.appendTo(i)}function r(n){var r=s.ie?n.target.parentNode:n.target,i=t(r),o=i.data("link");o&&e.broadcast("linkclick",o),n.preventDefault()}var i,s=e.getUtility("browser");return{init:function(e,n){i=t(e),this.createLinks(n),s.ie||i.on("click","."+k,r)},destroy:function(){i.empty().off("click"),i=s=null},createLinks:function(e){var t,r;for(t=0,r=e.length;r>t;++t)n(e[t])}}}),At.addComponent("page-svg",function(n){function r(){switch(S){case Et:case kt:return t("<iframe>");case Ct:case St:return t("<object>").attr({type:yt,data:"data:"+yt+";base64,"+e.btoa(wt)});case xt:return t("<div>");case Tt:return t("<object>");case Nt:case Lt:return t("<img>")}}function i(){c&&0!==c.length||(b=!1,c=r()),0===c.parent().length&&c.appendTo(h)}function s(){return b||S===Tt||S===Nt?t.Deferred().resolve().promise({abort:function(){}}):n.get("page-svg",d)}function o(e){var t=e.querySelectorAll("use");[].forEach.call(t,function(t){var n=t.getAttribute("xlink:href"),r=e.querySelector(n).cloneNode(),i=t.parentNode;r.removeAttribute("id"),r.setAttribute("transform",t.getAttribute("transform")),i.replaceChild(r,t)})}function u(t){var r,i,s,u,f,l=c[0].contentDocument,h=c[0].contentWindow||l&&l.defaultView;switch(S){case Et:v.ielt10&&(t=t.replace(/<xhtml:link.*/,"")),u=bt+t,v.ielt10?l.body.innerHTML=u:(l.documentElement.innerHTML=u,(v.ios||v.safari)&&v.version<7&&o(l)),s=l.getElementsByTagName("svg")[0];break;case kt:l.documentElement.innerHTML=bt;var p=l.getElementsByTagName("head")[0]||l.documentElement,g=l.createElement("script"),y="("+proxySVG+")()";g.type="text/javascript";try{g.appendChild(document.createTextNode(y))}catch(b){g.text=y}return p.insertBefore(g,p.firstChild),void ("complete"===l.readyState?h.loadSVG(t):h.onload=function(){this.loadSVG(t)});case St:r=new m,i=r.parseFromString(t,yt),s=l.importNode(i.documentElement,!0),l.documentElement.appendChild(s);break;case Ct:h.loadSVG(t),s=l.querySelector("svg");break;case xt:r=new m,i=r.parseFromString(t,yt),s=document.importNode(i.documentElement,!0),c.append(s);break;case Tt:c.attr({type:yt,data:n.getDataProvider("page-svg").getURL(d)}),s=c[0];break;case Nt:s=c[0],s.src=n.getDataProvider("page-svg").getURL(d);break;case Lt:s=c[0],f="data:"+yt,s.src=!v.ie&&e.btoa?f+";base64,"+e.btoa(t):f+","+encodeURIComponent(t)}s.setAttribute("width","100%"),s.setAttribute("height","100%")}function f(e){g||y||(!b&&e&&(u(e),b=!0,E||(p.abort(),p=null)),0===c.parent().length&&c.appendTo(h))}function l(e){n.broadcast("asseterror",e),b=!1,p&&p.abort()}var c,h,p,d,v=n.getUtility("browser"),m=e.DOMParser,g=!1,y=!1,b=!1,w=n.getConfig(),E=v.mobile||v.ielt10,S=v.ielt11||v.firefox?Lt:Et;return{init:function(e,t){h=e,d=t,S=w.embedStrategy||S},destroy:function(){g=!0,E=!0,this.unload(),h.empty()},prepare:function(){i()},preload:function(){this.prepare(),p||(p=s())},load:function(){return y=!1,this.preload(),p.done(f).fail(l),p},unload:function(){y=!0,p&&"resolved"!==p.state()&&(p.abort(),p=null),E&&(c&&(c.remove(),c=null),b=!1)}}}),At.addComponent("page-text",function(e){function n(){return p.enableTextSelection&&!f.ielt9}function r(e){var t,n;!e||h||c||(h=!0,t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,n=document.importNode(t.querySelector("."+C),!0),o.attr("class",n.getAttribute("class")),o.html(n.innerHTML),l.fix(o))}function i(t){t&&e.broadcast("asseterror",t)}function s(){return u||(u=n()?e.get("page-text",a):t.Deferred().resolve().promise({abort:function(){}})),u}var o,u,a,f=e.getUtility("browser"),l=e.getUtility("subpx"),c=!1,h=!1,p=e.getConfig();return{init:function(e,t){o=e,a=t},destroy:function(){c=!0,this.unload(),o.empty()},preload:function(){s()},load:function(){return s().done(r).fail(i)},unload:function(){u&&"resolved"!==u.state()&&(u.abort(),u=null)},enable:function(){o.css("display",""),u&&!h&&(u=null)},disable:function(){o.css("display","none")}}}),At.addComponent("page",function(e){var n,r,i,s,o,u,a,f,l=e.getUtility("support"),c=e.getUtility("common"),h=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(e,t){switch(e){case"pageavailable":(t.page===u+1||t.upto>u||t.all===!0)&&f===nt&&(f=rt);break;case"textenabledchange":t.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":a=o===t.page||c.inArray(o,t.visiblePages)>-1}},init:function(t,a){var c,h,p;n=t,h=t.find("."+N),c=t.find("."+C),p=t.find("."+L),f=a.status||rt,u=a.index,o=u+1,this.config=a,a.url=a.url||"",r=e.createComponent("page-text"),i=e.createComponent(l.svg?"page-svg":"page-img"),r.init(c,o),i.init(h,o),a.enableLinks&&a.links.length&&(s=e.createComponent("page-links"),s.init(p,a.links))},destroy:function(){this.unload()},preload:function(){i.prepare(),f===rt&&(i.preload(),r.preload())},load:function(){var s=this;return h=!0,f===ot?!1:f===nt?!1:(f!==st&&(f=it),t.when(i.load(),r.load()).done(function(){h?f!==st&&(n.removeClass(O),f=st,e.broadcast("pageload",{page:o})):s.unload()}).fail(function(t){f=ot,n.addClass(M),e.broadcast("pagefail",{page:u+1,error:t})}))},unload:function(){h=!1,i.unload(),r.unload(),f===st&&(f=rt,n.addClass(O),n.removeClass(M),e.broadcast("pageunload",{page:o}))},enableTextSelection:function(){r.enable(),a&&r.load()},disableTextSelection:function(){r.disable()}}}),At.addComponent("resizer",function(n){function r(){n.broadcast("resize",{width:c,height:h,clientWidth:f,clientHeight:l,offsetWidth:c,offsetHeight:h})}function i(){var e=p.getComputedStyle(u);e&&"static"===e.position&&t(u).css({position:"relative"})}function s(){var e=t('<iframe frameborder="0">'),n=t("<div>");e.add(n).css({opacity:0,visiblility:"hidden",position:"absolute",width:"100%",height:"100%",top:0,left:0,border:0}),e.prependTo(n.prependTo(u)),i(),v=t(e[0].contentWindow),v.on("resize",o)}function o(){var t=u.offsetHeight,s=u.offsetWidth;return y&&0===g&&0!==e.innerWidth?(g=e.innerWidth,i(),void n.broadcast("layoutchange")):void (t&&(t!==h||s!==c)&&(h=t,c=s,l=u.clientHeight,f=u.clientWidth,r()))}var u,f,l,c,h,p=n.getUtility("common"),d=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",v=t(e),m=t(document),g=0,y=function(){try{return e.self!==e.top}catch(t){return!0}}();return{messages:["layoutchange"],onmessage:function(){h=null,o()},init:function(n){u=t(n).get(0),u===e?(u=document.documentElement,v.on("resize",o)):s(),m.on(d,o),o()},destroy:function(){m.off(d,o),v.off("resize",o)}}}),At.addComponent("scroller",function(e){function n(){return{scrollTop:f.scrollTop(),scrollLeft:f.scrollLeft()}}function r(){g=!1,S=null,clearTimeout(l),e.broadcast("scrollend",n())}function i(){g||(g=!0,e.broadcast("scrollstart",n())),clearTimeout(l),l=setTimeout(r,m),x()}function s(){y=!0,b=!1,w=!1,i()}function o(){w=!0,i()}function u(){y=!1,b=!0,E=(new Date).getTime(),w&&a()}function a(){return clearTimeout(l),null===S&&(S=(new Date).getTime()),(new Date).getTime()-S>p?void r():(x(),void (l=setTimeout(a,d)))}var f,l,c=e.getUtility("common"),h=e.getUtility("browser"),p=3e3,d=30,v=200,m=h.mobile?500:250,g=!1,y=!1,b=!1,w=!1,E=0,S=null,x=c.throttle(v,function(){e.broadcast("scroll",n())});return{init:function(e){f=t(e),f.on("scroll",i),f.on("touchstart",s),f.on("touchmove",o),f.on("touchend",u)},destroy:function(){clearTimeout(l),f.off("scroll",i),f.off("touchstart",s),f.off("touchmove",o),f.off("touchend",u)}}}),At.addComponent("viewer-base",function(n){function r(){x.attr(i,S.metadata.version||"0.0.0"),M.mobile&&x.addClass(v),M.ielt9&&x.addClass(m),_.svg&&x.addClass(g)}function f(){x.html(At.viewerTemplate),S.useWindowAsViewport?(S.$viewport=t(e),x.addClass(y)):S.$viewport=x.find("."+u),S.$doc=x.find("."+o)}function h(){var e,t,r=S.plugins||{};for(e in r)t=n.createComponent("plugin-"+e),t&&O.isFn(t.init)&&t.init(S.plugins[e])}function p(){r(),C=n.createComponent("scroller"),C.init(S.$viewport),k=n.createComponent("resizer"),k.init(S.$viewport);var e;switch(S.metadata.type){case"text":e=n.createComponent("controller-text"),S.layout=tt;break;case"paged":default:e=n.createComponent("controller-paged")}e.init(),"text"===S.metadata.type?S.enableTextSelection||E.disableTextSelection():M.ielt9&&E.disableTextSelection(),(!S.enableLinks||M.ielt9)&&E.disableLinks(),E.setLayout(S.layout),n.broadcast("ready",{page:S.page||1,numPages:S.numPages}),n.ready()}function d(t){var n=E.fire("linkclick",t);n.isDefaultPrevented()||(t.uri?e.open(t.uri):t.destination&&E.scrollTo(t.destination.pagenum))}function b(e){e?L||(x.addClass(l),L=n.createComponent("dragger"),L.init(S.$viewport)):L&&(x.removeClass(l),n.destroyComponent(L),L=null)}function w(){var e;S.queryParams&&(e="string"==typeof S.queryParams?S.queryParams.replace(/^\?/,""):O.param(S.queryParams)),S.queryString=e?"?"+e:""}var E,S,x,T,N,C,k,L,A,O=n.getUtility("common"),M=n.getUtility("browser"),_=n.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"layoutchange":E.updateLayout();break;case"linkclick":d(t);break;case"zoom":t.zoom*=S.pageScale,t.prevZoom*=S.pageScale,S.enableDragging&&b(t.isDraggable),E.fire(e,t);break;case"dragstart":x.hasClass(c)||x.addClass(c),E.fire(e,t);break;case"dragend":x.hasClass(c)&&x.removeClass(c),E.fire(e,t);break;default:E.fire(e,t)}},init:function(){if(S=n.getConfig(),E=S.api,S.namespace=s+"-"+S.id,x=S.$el,x.addClass(s),x.addClass(S.namespace),!S.url)throw new Error("no URL given for viewer assets");/\/$/.test(S.url)||(S.url+="/"),S.url=n.getUtility("url").makeAbsolute(S.url),w(),f(),h()},destroy:function(){x.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),t(T).remove(),A&&A.abort()},setLayout:function(e){var t,r=S.page,i=S.zoom||1,s=S.layout;if(N){if(e===s)return N;r=N.state.currentPage,i=N.state.zoomState}if(t=n.createComponent("layout-"+e),!t)throw new Error("Invalid layout "+e);return N&&n.destroyComponent(N),S.layout=e,N=t,N.init(),N.setZoom(i.zoomMode||i.zoom||i),O.isFn(N.scrollTo)&&N.scrollTo(r),S.currentLayout=N,n.broadcast("layoutchange",{previousLayout:s,layout:e}),N},loadAssets:function(){var e,r,i,s;A||(r=n.get("metadata"),r.then(function(e){S.metadata=e}),M.ielt9?(T=O.insertCSS(""),S.stylesheet=T.styleSheet,e=t.when("").promise({abort:function(){}})):(e=n.get("stylesheet"),e.then(function(e){T=O.insertCSS(e),S.stylesheet=T.sheet})),!S.autoloadFirstPage||S.pageStart&&1!==S.pageStart||(_.svg?i=n.get("page-svg",1):S.conversionIsComplete&&(i=n.get("page-img",1)),S.enableTextSelection&&(s=n.get("page-text",1))),A=t.when(r,e).fail(function(e){A&&A.abort(),n.ready(),n.broadcast("asseterror",e),n.broadcast("fail",e)}).then(p).promise({abort:function(){A=null,r.abort(),e.abort(),i&&i.abort(),s&&s.abort()}}))}}}),At})}("undefined"!=typeof window?window:this),define("crocodoc.viewer.min",function(){}),define("player",["require","jquery","jade","log","framework","./crocodoc.viewer.min"],function(e){function f(e){return"content-area-"+e}function l(e){var t=u[e];return t?t:(n.error('no viewer found for content-area "'+e+'"'),null)}function c(){t("#widget-tabs").on("click",".content-player-outer .content-menu ul li.content-page-nav",function(e){h(e)}),t("#widget-tabs").on("click",".content-player-outer .content-preview-menu ul li.content-share",function(e){m(e)}),t("#widget-tabs").on("click",".content-player-outer .content-preview-menu ul li.content-preview-close",function(e){d(e)}),t("#widget-tabs").on("click",".content-player-outer .content-menu ul li.content-library",function(e){v(e)})}function h(e){var n=t(e.currentTarget),r=n.closest("ul").attr("data-content-area-id"),i=n.closest(".content-player-outer"),s=l(r);if(!s)return;var o=n.attr("data-nav-direction");o=o==="next"?Crocodoc.SCROLL_NEXT:Crocodoc.SCROLL_PREVIOUS,s.handle.scrollTo(o)}function p(e,t){var n=e.find(".content-player-outer"),r=t.data.page;if(n.attr("data-is-shared")==="yes"){var i=e.attr("data-tab-uuid"),s={uuid:i,page:r};o.send_info("*","navigate-to",s,0)}}function d(e){var n=t(e.currentTarget),r=n.closest("ul").attr("data-content-area-id"),i=l(r);if(!i)return;g(r,i,n.closest(".tab-pane"),!0)}function v(e){var n=t(e.currentTarget),r=n.closest(".tab-pane");b(r,"fullview-with-library")}function m(e){var n=t(e.currentTarget),r=n.closest(".tab-pane"),i=r.attr("data-tab-uuid"),s=n.closest(".content-player-outer"),u={uuid:r.attr("data-tab-uuid"),content_uri:s.attr("data-content-url")};o.send_info("*","new-content",u,0),o.tabs.sync_remote({uuid:i}),b(r,"fullview"),s.attr("data-is-shared","yes")}function g(e,t,r,i){try{t.handle.destroy()}catch(s){n.info("crocodoc destroy viewer exception ",s)}delete u[e],r.find(".content-player-outer").empty(),r.find(".content-player-outer").remove(),i&&b(r,null)}function b(e,t){t&&e.addClass("content-"+t);for(var n in y)n!=t&&e.removeClass("content-"+n)}var t=e("jquery");window.jade=e("jade");var n=e("log")("content-player","info"),r=e("framework"),i=e("./crocodoc.viewer.min"),s={},o,u={},a="https://boxcontent.s3.amazonaws.com/9a99bc2a1dde42698e1e6bab105193ab";s.init=function(e,t,n,r){return o=r,c(),!0},s.start=function(e,r,i){var l,c=t(e).attr("id"),h=t.Deferred();b(t(e),"loading"),s.destroy(t(e));var d=o.template("player"),v=f(c);t(e).append(d({content_area_id:v,content_uri:r,show_menu:i.show_menu,shared:i.shared&&(i.shared?"yes":"no")||"no"}));var m=t(e).find(".content-area");return r||(n.error("null content_uri"),r=a),l=Crocodoc.createViewer(m,{url:r}),l.load(),u[v]={handle:l},l.on("asseterror",function(e){n.error("content asseterror  = ",e),h.reject(e)}),l.on("fail",function(e){n.error("content failed to load  = ",e),h.reject(e)}),l.on("ready",function(s){n.info("viewer ready : data = ",s.data);try{l.setLayout(Crocodoc.LAYOUT_PRESENTATION)}catch(o){}var u=i.mode?i.mode:"fullview";b(t(e),u);try{n.info("scrolling to "+i.page),l.scrollTo(i.page||1)}catch(o){n.info("unable to scroll ["+r+"]: reason : ",o)}current_page=s.data.page;var a={current_page:current_page,total_pages:s.data.numPages};h.resolve(a)}),l.on("pagefocus",function(n){p(t(e),n)}),h.promise()},s.destroy=function(e){var n=e.find(".content-player-outer");if(n.length===0)return;var r=t(n.find("ul.nav")[0]).attr("data-content-area-id"),i=l(r);g(r,i,e,!1);if(n.attr("data-is-shared")==="yes"){var s=e.attr("data-tab-uuid");o.send_info("*","content-destroyed",{uuid:s},0)}},s.navigate=function(e,n){var r=t(e).find(".content-area").attr("id"),i=l(r);i.handle.scrollTo(n.page)};var y={loading:!0,preview:!0,fullview:!0,"fullview-with-library":!0};return s}),define("upload",["require","jquery","events","jade","identity","log"],function(e){function a(e,t){e.html(t)}function f(e,t,n,r){if(!r)return;this&&a(e,this),r&&r.error_message&&(r=r.error_message),v(t,r),c(n,r)}function l(e){a(e,"")}function c(e,t){var n=typeof t=="object"?"Server Error":t;i.error("mark_error : err = ",t),e.html(n),e.css("display","block")}function h(e){e.html(""),e.css("display","none")}function p(e,n,r,s){var o=t.Deferred(),u=e[0];i.info("upload_start : data = ",s);var f=new XMLHttpRequest;return f.open("PUT",s.upload_url),f.setRequestHeader("x-amz-acl","public-read"),f.upload.addEventListener("progress",m.bind(null,n)),f.onload=function(){if(f.status!==200){o.reject("upload failed with status code "+f.status),v(n,f.status);return}o.resolve(s,u),v(n,null)},f.onerror=function(e){i.error("upload_start: err = ",e),a(r,"Upload Failed"),o.reject(e)},f.send(u),a(r,"Uploading ..."),o.promise()}function d(e){e.find(".progress-bar").removeClass("progress-bar-danger"),e.find(".progress-bar").removeClass("progress-bar-success"),e.find(".progress-bar").css("width","0%"),e.fadeIn(500)}function v(e,t){e.find(".progress-bar").addClass("progress-bar-"+(t?"danger":"success")),e.find(".progress-bar").removeClass("progress-bar-"+(t?"success":"danger")),e.fadeOut(500)}function m(e,t){if(t.lengthComputable===!0){var n=t.loaded/t.total*100;e.find(".progress-bar").css("width",parseInt(t.loaded/t.total*100,10)+"%")}}function g(e,n,r,i,s){var u=t.Deferred();a(r,"Finalizing upload ...");var f="upload_complete",l={name:s.name,path:"/vctemp/"+encodeURI(s.name),type:s.type,size:s.size,url:i.access_url,user_id:"arvind@authorgen.com",vc_id:o.identity.vc_id,u_name:o.identity.id,removeafter:3600,tags:"content, pdf"};return n.find(".content-conversion-busy").css("display","block"),o.send_command(null,f,l,0).then(function(e){u.resolve(i,e)},function(e){u.reject(e),a(r,"Upload Complete Info Error.")}),u.promise()}function y(e,n,r,i,s,u){var f=t.Deferred();a(i,"Processing ...");var l="start-conversion",c={name:u.name,path:"/"+encodeURI(u.name),type:u.type,size:u.size,url:s.access_url,user_id:e,vc_id:o.identity.vc_id,u_name:o.identity.id,tags:"content, pdf"};return r.find(".content-conversion-busy").css("display","block"),o.send_command(null,l,c,0).then(function(e){f.resolve(s,e),a(i,"Conversion Finished")},function(e){f.reject(e),a(i,"Conversion Failed")}).always(function(){r.find(".content-conversion-busy").css("display","none")}),f.promise()}function b(e,n,r){var i=t.Deferred();return u.emit("content-added",{tab:e.tab_anchor,name:r.name,type:r.type,created_at:r.created_at,id:r.id,raw_file_url:n.access_url,conv_url:r.url,thumbnail:r.thumbnail}),i.resolve(n),i.promise()}function w(){}function E(e){return"content-area-"+e}function S(e,t){var n="get-tmp-url",r={path:"/vctemp/"+encodeURI(t.name),name:t.name,type:t.type?t.type:t.name.replace(/^.*\./g,""),user_id:e};return i.info("get_presigned_url: sending ",r),o.send_command(null,n,r,0)}var t=e("jquery"),n=e("events");window.jade=e("jade");var r=e("identity"),i=e("log")("upload","info"),s={},o,u=n.emitter("content:upload","upload");return s.init=function(e,t,n,r){return o=r,w(),!0},s.prepare=function(e){var n=e.anchor,r=e.email,i=n.find(".content-upload-label"),s=n.find(".content-upload-input"),o=n.find(".content-upload-error"),u=n.find(".content-upload-status"),c=n.find(".progress");i.on("click",function(e){s.trigger("click")}),s.on("click",function(e){a(u,""),s.val(null)}),s.on("change",function(i){var s=t(i.currentTarget)[0].files;if(!s||s.length===0)return;h(o),d(c),a(u,"Requesting ..."),S(r,s[0]).then(p.bind(null,s,c,u),f.bind("Request Failed",u,c,o)).then(g.bind(null,s,n,u),f.bind("Upload Failed",u,c,o)).then(y.bind(null,r,s,n,u),f.bind("Upload Failed",u,c,o)).then(b.bind(null,e),f.bind("Conversion Failed",u,c,o)).then(l.bind(null,u),f.bind("Post Conversion Failed",u,c,o))})},s}),define("library",["require","jquery","events","jade","log","./upload","./player"],function(e){function f(e,t){h(e).then(p.bind(t),c.bind(t)).then(l.bind(t))}function l(){var e=this;e.find("span.busy").fadeOut()}function c(e){r.error(e,"TODO: handle this error")}function h(e){var t="get-content",n={user_id:e};return u.send_command(null,t,n,0)}function p(e){var t=this;for(var n=0;n<e.data.length;n++){var r=e.data[n];d(t,r)}}function d(e,t){var n=u.template("library-item"),i=n(t);r.info("adding ",t),e.find(".content-lib-items ul").append(i)}function v(){t("#widget-tabs").on("click","a.content-preview-trigger",g)}function m(e){return"content-area-"+e}function g(e){var n=t(e.currentTarget).closest(".content-lib-main"),r=n.attr("data-tab-anchor-id"),i=n.closest("#"+r)[0],o=t(e.currentTarget).attr("data-content-url");s.start(i,o,{show_menu:!0,mode:"preview"})}function y(e,n){switch(e){case"content-added":var i=t(n.tab),o=n.conv_url,u=t("#widget-tabs").find(".content-lib-main");for(var a=0;a<u.length;a++){var f=t(u[a]);d(f,{name:n.name,url:n.conv_url,type:n.type,thumbnail:n.thumbnail})}s.start(i,o,{show_menu:!0,show_library_icon:!0,mode:"preview"});break;default:r.error('unknown event "'+e+'". possibly a bug in the code. ignoring.')}}var t=e("jquery"),n=e("events");window.jade=e("jade");var r=e("log")("library","info"),i=e("./upload"),s=e("./player"),o={},u,a={};return n.bind("content:upload",y,"library"),o.init=function(e,t,n,r){return u=r,v(),!0},o.start=function(e){var n,s=e.anchor,o=t(s).attr("id"),a=t.Deferred();r.info("identity - ",u.identity);var l=u.identity.email||"test@wiziq.com";u.identity.email==="-----"&&(l="test@wiziq.com");var c=u.template("library"),h=m(o);return t(s).append(c({tab_anchor_id:o,email:l})),i.prepare({anchor:t(s).find(".content-lib-upload"),tab_anchor:s,email:l}),f(l,t(s).find(".content-lib-main")),a.resolve(),a.promise()},o.destroy=function(e){e.empty()},o}),define("content",["require","jquery","jade","log","framework","./player","./library","./upload"],function(e){function f(e){var t={uuid:e.uuid,remote_slave:e.remote_slave,startup:e.startup||!1},n=a.tabs.get_by_uuid(e.uuid);n||(n=a.tabs.create(t)),t={shared:e.shared,show_menu:e.show_menu,mode:"fullview",page:e.page||1},i.start(n.anchor,e.content_uri,t)}function l(e){var t=a.tabs.get_by_uuid(e.uuid);if(!t){n.error("rx remote navigation for non-existent tab : uuid = "+e.uuid);return}i.navigate(t.anchor,e)}var t=e("jquery");window.jade=e("jade");var n=e("log")("content","info"),r=e("framework"),i=e("./player"),s=e("./library"),o=e("./upload"),u={},a=r.handle("content");return u.init=function(e,n,r){var u=t.Deferred();return s.init(e,n,r,a)?o.init(e,n,r,a)?i.init(e,n,r,a)?(u.resolve(),u.promise()):(u.reject("content player init failed"),u.promise()):(u.reject("content upload init failed"),u.promise()):(u.reject("content library init failed"),u.promise())},u.info=function(e,t,r,i){switch(t){case"new-content":return r.remote_slave=!0,r.show_menu=!1,r.shared=!1,f(r);case"navigate-to":return l(r);default:n.error("received unknown info_id ("+t+"). Ignoring.");return}},u.start=function(e){n.info("sess_info = ",e);for(var t in e.shared){var r=a.identity.vc_id,i=e.shared[t].owner===r?!1:!0;i||(u.create({uuid:t,remote_slave:i,startup:!0}),a.tabs.sync_remote({uuid:t})),f({uuid:t,content_uri:e.shared[t].content_uri,remote_slave:i,show_menu:i?!1:!0,shared:i?!1:!0,page:e.shared[t].page,startup:!0})}return},u.create=function(e){var t=e||{},n=a.tabs.create(t);return s.start(n)},u.destroy=function(e,t){n.info("content.destroy: $tab_anchor",e,"uuid = "+t),i.destroy(e),s.destroy(e)},u}),require([""]);