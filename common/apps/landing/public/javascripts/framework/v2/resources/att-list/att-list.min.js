define("element",["require","jquery"],function(e){var t=e("jquery"),n={},r={},i="_att_skin";return r.handle=function(e,r){var s=n[e];return s||(s=n[e]=t("#"+e+i)),r?s.find("#"+r):s},r.forget=function(e){n[e]=undefined},r}),define("search",["require","jquery","./element"],function(e){function f(){var e,n=t(this).val();n&&(n=n.toLowerCase()),Object.keys(i).forEach(function(t){e=i[t];for(var r=0;r<a;r++)if(~e.identity[u[r]].indexOf(n))return l(t,!0);return l(t,!1)})}function l(e,t){var r=n.handle(e);t?r.show():r.hide();return}var t=e("jquery"),n=e("./element"),r={},i={},s={},o={},u=["displayName","email"],a=u.length;return r.init=function(e,n){o=n,s=e,i=s.get_users(),t("#atl-search input").attr("placeholder","Search a name or an email"),t("#atl-search input").on("keyup",f)},r.update=function(e){i=s.get_users()},r}),define("scroll",["require","jquery"],function(e){function s(e){var n=t(this),s=n.scrollTop(),o=r<s?Math.ceil:Math.floor;if(r==s)return;r=o(s/i)*i,n.scrollTop(r),r=n.scrollTop()}var t=e("jquery"),n={},r=0,i=1;return n.start=function(e){var t=e.find("li").height();i=t?t:"72",e.on("scroll",s)},n}),define("widget",["require","./search","./scroll"],function(e){function u(e){var t="http://www.gravatar.com/avatar/?d=mm&s=40",r;if(e.history){var i=$(e.history).get(-1);i?i=i.joined:i;var s=new Date(i),o=s.getHours(),u=s.getMinutes();u=u<10?"0"+u:u,r=o+":"+u}e.avatar=e.photos?e.photos[0].value:t,e.time="Joined: "+(r||"---"),e.email=e.emails?e.emails[0].value:"-----",e.authvia=e.authvia||"---",e.att_id=e.vc_id+n}var t=e("./search"),n="_att_skin",r={},i={},s={},o={};i.init=function(e,t,n,i){var a=$.Deferred();o=i,s=$(e);var f=t[0];return u(n),s.append(f(n)),$("#atl-search input").attr("placeholder","No One To Search.."),r=t[1],a.resolve(),a.promise()},i.add_user=function(e){var n=$.Deferred();u(e);var i=r(e);return i||o.info("template creation failed"),$("#atl-list").append(i),t.update(),n.resolve(),n.promise()},i.toggle_visible=function(){s.toggle(),a&&a.ack()},i.remove_user=function(e){$("#"+e+n).remove(),t.update()};var a={ack:function(){e("./scroll").start($("#atl-list-wrap")),a=null}};return i}),define("controls",["require","jquery","./element"],function(e){function a(e){var n=t(this).closest("li").attr("id");if(!n)return r.info("warn:::user id not found...did someone change the user template?"),!1;var s=n.replace(u,""),a=t(this).attr("id"),f=a.replace("-slashed","");val=undefined,i[s]=i[s]||{};if(i[s][f]=="busy"||i[s][f]==undefined)return r.info("attempted to change while in 'busy/undef' state. Is a problem, control shouldn't be clickable"),!1;switch(a){case"microphone":val="false";break;case"microphone-slashed":val="true";break;case"camera":val="false";break;case"camera-slashed":val="true";break;default:r.info(f+" clicked____and is not handled");return}val&&(o.set_meta(s,f,val,!0),l(s,f)),r.info(s+" key: "+f+", to be val:"+val+", on_click")}function f(e,t,r){if(t=="audio-control"){var i=n.handle(e,t);i.css("width",r*100+"px");return}var s=n.handle(e,t),o=n.handle(e,t+"-slashed");r?(s.show().css("display","inline-block"),o.hide()):(o.show().css("display","inline-block"),s.hide())}function l(e,t,s){var o=n.handle(e,t),u=n.handle(e,t+"-slashed");switch(i[e][t]){case undefined:case"busy":o.css("fill","green"),u.css("fill","red"),i[e][t]="set";break;case"set":o.css("fill","yellow"),u.css("fill","yellow"),i[e][t]="busy";break;default:r.info("element found in some unknown state"),i[e][t]=undefined}}var t=e("jquery"),n=e("./element"),r={},i={},s={},o={},u="_att_skin";return s.init=function(e,n){var i=t.Deferred();return r=n,window.att_api=e,o=e,t("#atl-list").on("click",".atl-control",a),i.resolve(),i.promise()},s.change=function(e,t,n){i[e]=i[e]||{};switch(i[e][t]){case undefined:f(e,t,n),l(e,t);break;case"set":f(e,t,n);break;case"busy":f(e,t,n),l(e,t)}},s.forget=function(e){i[e]=undefined,n.forget(e)},s}),define("listener",["require","events","./controls","./widget"],function(e){function a(e,t){switch(e){case"in":t.forEach(function(e){r.add_user(e)});break;case"out":r.remove_user(t),n.forget(t);break;case"control_changed":n.change(t.vc_id,t.known_key,t.value);break;default:u.info("some event: "+e+" @atl_skin, not my problem")}}var t=e("events"),n=e("./controls"),r=e("./widget"),i="framework:attendees",s="att-list",o={},u={};return o.init=function(e){u=e,t.bind(i,a,s)},o}),define("att-list",["require","jquery","framework","log","./widget","./controls","./search","./listener"],function(e){function l(e){t("#widget-attendees").toggle(),i.toggle_visible()}var t=e("jquery"),n=e("framework"),r=e("log")("att-list","info"),i=e("./widget"),s=e("./controls"),o=e("./search"),u=e("./listener"),a={},f=n.handle("att-list");return a.init=function(e,n,a){var c=t.Deferred();if(!e.anchor||e.templates.length!=2)return c.reject("wrong info from backend"),c.promise();var h=[],p=e.anchor,d=t("#nav-attendees");return h.push(f.template(e.templates[0])),h.push(f.template(e.templates[1])),d.on("click",l),t(p).hide(),i.init(p,h,f.identity,r).then(s.init.bind(undefined,f.attendees,r),c.reject).then(o.init.bind(undefined,f.attendees,r),c.reject).then(c.resolve,c.reject),u.init(r),c.promise()},a.start=function(){var e=f.attendees.get_users();r.info("attendee info:: "+Object.toString(e)),Object.keys(e).forEach(function(t){i.add_user(e[t].identity)})},a}),require([""]);